<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard - OneZeroEight.ai</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        :root {
            --primary: #6366f1;
            --primary-dark: #4f46e5;
            --secondary: #10b981;
            --warning: #f59e0b;
            --danger: #ef4444;
            --dark: #1f2937;
            --darker: #111827;
            --light: #f9fafb;
            --text: #374151;
            --text-light: #6b7280;
            --border: #e5e7eb;
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--light);
            color: var(--text);
            min-height: 100vh;
        }
        .sidebar {
            position: fixed;
            left: 0;
            top: 0;
            bottom: 0;
            width: 220px;
            background: var(--darker);
            color: white;
            padding: 1.5rem 1rem;
        }
        .sidebar-logo {
            font-size: 1.2rem;
            font-weight: 700;
            color: white;
            text-decoration: none;
            display: block;
            margin-bottom: 2rem;
        }
        .sidebar-nav { list-style: none; }
        .sidebar-nav li { margin-bottom: 0.25rem; }
        .sidebar-nav a {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.75rem 1rem;
            color: rgba(255,255,255,0.7);
            text-decoration: none;
            border-radius: 8px;
            cursor: pointer;
        }
        .sidebar-nav a:hover, .sidebar-nav a.active {
            background: rgba(255,255,255,0.1);
            color: white;
        }
        .sidebar-nav a.active { background: var(--primary); }
        .sidebar-section {
            font-size: 0.7rem;
            text-transform: uppercase;
            color: rgba(255,255,255,0.4);
            margin: 1.5rem 0 0.5rem;
            padding-left: 1rem;
        }
        .main {
            margin-left: 220px;
            padding: 1.5rem;
        }
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }
        .header h1 { font-size: 1.5rem; font-weight: 700; color: var(--dark); }
        .btn {
            padding: 0.5rem 1rem;
            border-radius: 6px;
            font-weight: 600;
            font-size: 0.85rem;
            border: none;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            gap: 0.4rem;
        }
        .btn-primary { background: var(--primary); color: white; }
        .btn-primary:hover { background: var(--primary-dark); }
        .btn-secondary { background: white; color: var(--text); border: 1px solid var(--border); }
        .btn-danger { background: var(--danger); color: white; }
        .btn-small { padding: 0.3rem 0.6rem; font-size: 0.75rem; }
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 1rem;
            margin-bottom: 1.5rem;
        }
        .stat-card {
            background: white;
            border-radius: 10px;
            padding: 1.25rem;
            border: 1px solid var(--border);
        }
        .stat-card-title { font-size: 0.8rem; color: var(--text-light); }
        .stat-card-value { font-size: 2rem; font-weight: 700; color: var(--dark); margin-top: 0.25rem; }
        .stat-card-sub { font-size: 0.75rem; color: var(--text-light); margin-top: 0.25rem; }
        .table-card {
            background: white;
            border-radius: 10px;
            border: 1px solid var(--border);
            overflow: hidden;
        }
        .table-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem 1.25rem;
            border-bottom: 1px solid var(--border);
            flex-wrap: wrap;
            gap: 0.5rem;
        }
        .table-header h2 { font-size: 1rem; font-weight: 600; color: var(--dark); }
        .table-actions { display: flex; gap: 0.5rem; align-items: center; }
        .search-input {
            padding: 0.5rem 0.75rem;
            border: 1px solid var(--border);
            border-radius: 6px;
            font-size: 0.85rem;
            width: 200px;
        }
        .table-container { max-height: 600px; overflow-y: auto; }
        table { width: 100%; border-collapse: collapse; }
        th, td { padding: 0.75rem 1rem; text-align: left; border-bottom: 1px solid var(--border); }
        th { font-size: 0.75rem; font-weight: 600; color: var(--text-light); text-transform: uppercase; background: var(--light); position: sticky; top: 0; }
        td { font-size: 0.85rem; }
        tr:hover { background: rgba(99, 102, 241, 0.02); }
        .badge {
            display: inline-block;
            padding: 0.2rem 0.6rem;
            border-radius: 50px;
            font-size: 0.75rem;
            font-weight: 500;
        }
        .badge-green { background: rgba(16, 185, 129, 0.1); color: var(--secondary); }
        .badge-blue { background: rgba(99, 102, 241, 0.1); color: var(--primary); }
        .badge-yellow { background: rgba(245, 158, 11, 0.1); color: var(--warning); }
        .badge-gray { background: rgba(107, 114, 128, 0.1); color: var(--text-light); }
        .tab-content { display: none; }
        .tab-content.active { display: block; }
        .empty-state { text-align: center; padding: 3rem; color: var(--text-light); }
        .actions { display: flex; gap: 0.5rem; }
        .actions button {
            padding: 0.3rem 0.5rem;
            font-size: 0.75rem;
            border-radius: 4px;
            border: 1px solid var(--border);
            background: white;
            cursor: pointer;
        }
        .actions button:hover { background: var(--light); }
        .error { color: var(--danger); padding: 1rem; background: rgba(239,68,68,0.1); border-radius: 8px; margin-bottom: 1rem; }
        .success { color: var(--secondary); padding: 1rem; background: rgba(16,185,129,0.1); border-radius: 8px; margin-bottom: 1rem; }
        
        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }
        .modal.active { display: flex; }
        .modal-content {
            background: white;
            border-radius: 12px;
            padding: 1.5rem;
            width: 90%;
            max-width: 500px;
            max-height: 90vh;
            overflow-y: auto;
        }
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }
        .modal-header h3 { font-size: 1.1rem; font-weight: 600; }
        .modal-close {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--text-light);
        }
        .form-group { margin-bottom: 1rem; }
        .form-group label {
            display: block;
            font-size: 0.85rem;
            font-weight: 500;
            margin-bottom: 0.25rem;
            color: var(--dark);
        }
        .form-group input, .form-group select {
            width: 100%;
            padding: 0.6rem 0.75rem;
            border: 1px solid var(--border);
            border-radius: 6px;
            font-size: 0.9rem;
        }
        .form-group input:focus, .form-group select:focus {
            outline: none;
            border-color: var(--primary);
        }
        .form-actions { display: flex; gap: 0.5rem; justify-content: flex-end; margin-top: 1.5rem; }
        
        .link { color: var(--primary); text-decoration: none; }
        .link:hover { text-decoration: underline; }
        
        @media (max-width: 900px) {
            .sidebar { display: none; }
            .main { margin-left: 0; }
            .stats-grid { grid-template-columns: repeat(2, 1fr); }
        }
    </style>
</head>
<body>
    <aside class="sidebar">
        <a href="https://onezeroeight.ai" class="sidebar-logo">üéµ OneZeroEight</a>
        <nav>
            <ul class="sidebar-nav">
                <li><a onclick="showTab('dashboard')" class="active" id="nav-dashboard">üìä Dashboard</a></li>
                <li><a onclick="showTab('artists')" id="nav-artists">üë®‚Äçüé§ Artists</a></li>
                <li><a onclick="showTab('curators')" id="nav-curators">üë• Curators</a></li>
                <li><a onclick="showTab('campaigns')" id="nav-campaigns">üìã Campaigns</a></li>
            </ul>
            <div class="sidebar-section">Links</div>
            <ul class="sidebar-nav">
                <li><a href="https://onezeroeight.ai" target="_blank">üåê Website</a></li>
                <li><a href="https://discord.gg/4A6ExTnKnK" target="_blank">üí¨ Discord</a></li>
                <li><a href="https://polygonscan.com/token/0x0b3f81d3E1FA01e911A8B4e49048eEA0ddf2A896" target="_blank">ü™ô SUTRA</a></li>
            </ul>
        </nav>
    </aside>

    <main class="main">
        <!-- Dashboard Tab -->
        <div id="tab-dashboard" class="tab-content active">
            <div class="header">
                <h1>Dashboard</h1>
                <button class="btn btn-primary" onclick="loadAll()">üîÑ Refresh</button>
            </div>
            <div id="error-msg"></div>
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-card-title">Total Artists</div>
                    <div class="stat-card-value" id="stat-artists">-</div>
                </div>
                <div class="stat-card">
                    <div class="stat-card-title">Total Curators</div>
                    <div class="stat-card-value" id="stat-curators">-</div>
                    <div class="stat-card-sub" id="stat-followers">- followers</div>
                </div>
                <div class="stat-card">
                    <div class="stat-card-title">Active Campaigns</div>
                    <div class="stat-card-value" id="stat-campaigns">-</div>
                </div>
                <div class="stat-card">
                    <div class="stat-card-title">Total Placements</div>
                    <div class="stat-card-value" id="stat-placements">-</div>
                </div>
            </div>
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-card-title">Revenue</div>
                    <div class="stat-card-value" id="stat-revenue">$0</div>
                </div>
                <div class="stat-card">
                    <div class="stat-card-title">SUTRA Distributed</div>
                    <div class="stat-card-value" id="stat-sutra">0</div>
                </div>
                <div class="stat-card">
                    <div class="stat-card-title">Avg Followers/Curator</div>
                    <div class="stat-card-value" id="stat-avg-followers">-</div>
                </div>
                <div class="stat-card">
                    <div class="stat-card-title">Total Reach</div>
                    <div class="stat-card-value" id="stat-total-reach">-</div>
                </div>
            </div>
        </div>

        <!-- Artists Tab -->
        <div id="tab-artists" class="tab-content">
            <div class="header">
                <h1>Artists <span style="font-weight:normal;color:var(--text-light)">(<span id="artist-count">0</span>)</span></h1>
            </div>
            <div class="table-card">
                <div class="table-header">
                    <h2>All Artists</h2>
                    <div class="table-actions">
                        <input type="text" class="search-input" placeholder="Search artists..." oninput="filterArtists(this.value)">
                        <button class="btn btn-secondary" onclick="exportArtists()">üì• Export</button>
                    </div>
                </div>
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>Name</th>
                                <th>Artist Name</th>
                                <th>Email</th>
                                <th>Spotify</th>
                                <th>Genre</th>
                                <th>SUTRA</th>
                                <th>Created</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="artists-table"></tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Curators Tab -->
        <div id="tab-curators" class="tab-content">
            <div class="header">
                <h1>Curators <span style="font-weight:normal;color:var(--text-light)">(<span id="curator-count">0</span>)</span></h1>
            </div>
            <div class="table-card">
                <div class="table-header">
                    <h2>All Curators</h2>
                    <div class="table-actions">
                        <input type="text" class="search-input" placeholder="Search curators..." oninput="filterCurators(this.value)">
                        <button class="btn btn-secondary" onclick="exportCurators()">üì• Export</button>
                    </div>
                </div>
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>Name</th>
                                <th>Email</th>
                                <th>Followers</th>
                                <th>Status</th>
                                <th>Contacted</th>
                                <th>Placements</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="curators-table"></tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Campaigns Tab -->
        <div id="tab-campaigns" class="tab-content">
            <div class="header">
                <h1>Campaigns <span style="font-weight:normal;color:var(--text-light)">(<span id="campaign-count">0</span>)</span></h1>
            </div>
            <div class="table-card">
                <div class="table-header">
                    <h2>All Campaigns</h2>
                    <div class="table-actions">
                        <input type="text" class="search-input" placeholder="Search campaigns..." oninput="filterCampaigns(this.value)">
                    </div>
                </div>
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Artist</th>
                                <th>Track</th>
                                <th>Tier</th>
                                <th>Status</th>
                                <th>Placements</th>
                                <th>Created</th>
                            </tr>
                        </thead>
                        <tbody id="campaigns-table"></tbody>
                    </table>
                </div>
            </div>
        </div>
    </main>

    <!-- Edit Artist Modal -->
    <div class="modal" id="editArtistModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Edit Artist</h3>
                <button class="modal-close" onclick="closeModal('editArtistModal')">&times;</button>
            </div>
            <form onsubmit="saveArtist(event)">
                <input type="hidden" id="edit-artist-id">
                <div class="form-group">
                    <label>Name</label>
                    <input type="text" id="edit-artist-name">
                </div>
                <div class="form-group">
                    <label>Artist Name</label>
                    <input type="text" id="edit-artist-artistname">
                </div>
                <div class="form-group">
                    <label>Email</label>
                    <input type="email" id="edit-artist-email">
                </div>
                <div class="form-group">
                    <label>Spotify Link</label>
                    <input type="url" id="edit-artist-spotify">
                </div>
                <div class="form-group">
                    <label>Genre</label>
                    <input type="text" id="edit-artist-genre">
                </div>
                <div class="form-group">
                    <label>SUTRA Balance</label>
                    <input type="number" id="edit-artist-sutra">
                </div>
                <div class="form-actions">
                    <button type="button" class="btn btn-secondary" onclick="closeModal('editArtistModal')">Cancel</button>
                    <button type="submit" class="btn btn-primary">Save Changes</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Edit Curator Modal -->
    <div class="modal" id="editCuratorModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Edit Curator</h3>
                <button class="modal-close" onclick="closeModal('editCuratorModal')">&times;</button>
            </div>
            <form onsubmit="saveCurator(event)">
                <input type="hidden" id="edit-curator-id">
                <div class="form-group">
                    <label>Name</label>
                    <input type="text" id="edit-curator-name">
                </div>
                <div class="form-group">
                    <label>Email</label>
                    <input type="email" id="edit-curator-email">
                </div>
                <div class="form-group">
                    <label>Followers</label>
                    <input type="number" id="edit-curator-followers">
                </div>
                <div class="form-group">
                    <label>Status</label>
                    <select id="edit-curator-status">
                        <option value="active">Active</option>
                        <option value="inactive">Inactive</option>
                        <option value="pending">Pending</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Spotify Profile URL</label>
                    <input type="url" id="edit-curator-spotify">
                </div>
                <div class="form-actions">
                    <button type="button" class="btn btn-secondary" onclick="closeModal('editCuratorModal')">Cancel</button>
                    <button type="submit" class="btn btn-primary">Save Changes</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        // Password protection
        (function() {
            var storedAuth = sessionStorage.getItem('108admin');
            if (storedAuth !== 'authenticated') {
                var password = prompt('Enter admin password:');
                if (password !== 'Sutra108!') {
                    document.body.innerHTML = '<div style="display:flex;align-items:center;justify-content:center;height:100vh;font-family:sans-serif;"><h1 style="color:#ef4444;">Access Denied</h1></div>';
                    throw new Error('Unauthorized');
                }
                sessionStorage.setItem('108admin', 'authenticated');
            }
        })();

        var API = 'https://onezeroeight-backend-production.up.railway.app/api';
        var artists = [];
        var curators = [];
        var campaigns = [];

        document.addEventListener('DOMContentLoaded', loadAll);

        function loadAll() {
            loadStats();
            loadArtists();
            loadCurators();
            loadCampaigns();
        }

        function showError(msg) {
            document.getElementById('error-msg').innerHTML = '<div class="error">' + msg + '</div>';
        }

        function showSuccess(msg) {
            document.getElementById('error-msg').innerHTML = '<div class="success">' + msg + '</div>';
            setTimeout(function() { document.getElementById('error-msg').innerHTML = ''; }, 3000);
        }

        function loadStats() {
            fetch(API + '/admin/stats')
                .then(function(res) { return res.json(); })
                .then(function(data) {
                    document.getElementById('stat-artists').textContent = data.total_artists || 0;
                    document.getElementById('stat-curators').textContent = data.total_curators || 0;
                    document.getElementById('stat-campaigns').textContent = data.active_campaigns || 0;
                    document.getElementById('stat-placements').textContent = data.total_placements || 0;
                    document.getElementById('stat-revenue').textContent = '$' + (data.total_revenue || 0).toFixed(2);
                    document.getElementById('stat-sutra').textContent = (data.sutra_distributed || 0);
                })
                .catch(function(e) {
                    console.error('Stats error:', e);
                    showError('Failed to load stats: ' + e.message);
                });
        }

        function loadArtists() {
            fetch(API + '/admin/artists?page_size=1000')
                .then(function(res) { return res.json(); })
                .then(function(data) {
                    artists = data.artists || [];
                    document.getElementById('artist-count').textContent = artists.length;
                    renderArtists(artists);
                })
                .catch(function(e) { console.error('Artists error:', e); });
        }

        function loadCurators() {
            fetch(API + '/admin/curators?page_size=2000')
                .then(function(res) { return res.json(); })
                .then(function(data) {
                    curators = data.curators || [];
                    document.getElementById('curator-count').textContent = curators.length;
                    
                    // Calculate follower stats
                    var totalFollowers = 0;
                    for (var i = 0; i < curators.length; i++) {
                        totalFollowers += curators[i].total_followers || 0;
                    }
                    var avgFollowers = curators.length ? Math.round(totalFollowers / curators.length) : 0;
                    
                    document.getElementById('stat-followers').textContent = totalFollowers.toLocaleString() + ' followers';
                    document.getElementById('stat-avg-followers').textContent = avgFollowers.toLocaleString();
                    document.getElementById('stat-total-reach').textContent = (totalFollowers / 1000000).toFixed(1) + 'M';
                    
                    renderCurators(curators);
                })
                .catch(function(e) { console.error('Curators error:', e); });
        }

        function loadCampaigns() {
            fetch(API + '/admin/campaigns?page_size=1000')
                .then(function(res) { return res.json(); })
                .then(function(data) {
                    campaigns = data.campaigns || [];
                    document.getElementById('campaign-count').textContent = campaigns.length;
                    renderCampaigns(campaigns);
                })
                .catch(function(e) { console.error('Campaigns error:', e); });
        }

        function renderArtists(list) {
            var tbody = document.getElementById('artists-table');
            if (!list.length) {
                tbody.innerHTML = '<tr><td colspan="8" class="empty-state">No artists yet</td></tr>';
                return;
            }
            var html = '';
            for (var i = 0; i < list.length; i++) {
                var a = list[i];
                var spotifyLink = a.spotify_link ? '<a href="' + a.spotify_link + '" target="_blank" class="link">üîó</a>' : '-';
                html += '<tr>';
                html += '<td>' + (a.name || '-') + '</td>';
                html += '<td>' + (a.artist_name || '-') + '</td>';
                html += '<td>' + (a.email || '-') + '</td>';
                html += '<td>' + spotifyLink + '</td>';
                html += '<td>' + (a.genre || '-') + '</td>';
                html += '<td>' + (a.sutra_balance || 0) + '</td>';
                html += '<td>' + formatDate(a.created_at) + '</td>';
                html += '<td class="actions">';
                html += '<button onclick="editArtist(\'' + a.id + '\')">Edit</button>';
                html += '<button onclick="copyEmail(\'' + a.email + '\')">Copy</button>';
                html += '</td>';
                html += '</tr>';
            }
            tbody.innerHTML = html;
        }

        function renderCurators(list) {
            var tbody = document.getElementById('curators-table');
            if (!list.length) {
                tbody.innerHTML = '<tr><td colspan="7" class="empty-state">No curators yet</td></tr>';
                return;
            }
            var html = '';
            for (var i = 0; i < list.length; i++) {
                var c = list[i];
                var statusClass = c.status === 'active' ? 'green' : 'gray';
                html += '<tr>';
                html += '<td>' + (c.name || '-') + '</td>';
                html += '<td>' + (c.email || '-') + '</td>';
                html += '<td>' + (c.total_followers || 0).toLocaleString() + '</td>';
                html += '<td><span class="badge badge-' + statusClass + '">' + c.status + '</span></td>';
                html += '<td>' + (c.times_contacted || 0) + '</td>';
                html += '<td>' + (c.placements_made || 0) + '</td>';
                html += '<td class="actions">';
                html += '<button onclick="editCurator(\'' + c.id + '\')">Edit</button>';
                html += '<button onclick="copyEmail(\'' + c.email + '\')">Copy</button>';
                if (c.spotify_profile_url) {
                    html += '<a href="' + c.spotify_profile_url + '" target="_blank" class="btn btn-small">Spotify</a>';
                }
                html += '</td>';
                html += '</tr>';
            }
            tbody.innerHTML = html;
        }

        function renderCampaigns(list) {
            var tbody = document.getElementById('campaigns-table');
            if (!list.length) {
                tbody.innerHTML = '<tr><td colspan="7" class="empty-state">No campaigns yet</td></tr>';
                return;
            }
            var html = '';
            for (var i = 0; i < list.length; i++) {
                var c = list[i];
                var statusClass = c.status === 'completed' ? 'green' : 'yellow';
                html += '<tr>';
                html += '<td>' + (c.id || '-').substring(0, 8) + '</td>';
                html += '<td>' + (c.artist_name || '-') + '</td>';
                html += '<td>' + (c.track_title || '-') + '</td>';
                html += '<td><span class="badge badge-blue">' + (c.tier || '-') + '</span></td>';
                html += '<td><span class="badge badge-' + statusClass + '">' + c.status + '</span></td>';
                html += '<td>' + (c.placements_count || 0) + '</td>';
                html += '<td>' + formatDate(c.created_at) + '</td>';
                html += '</tr>';
            }
            tbody.innerHTML = html;
        }

        function showTab(tab) {
            var contents = document.querySelectorAll('.tab-content');
            for (var i = 0; i < contents.length; i++) {
                contents[i].classList.remove('active');
            }
            var navs = document.querySelectorAll('.sidebar-nav a');
            for (var i = 0; i < navs.length; i++) {
                navs[i].classList.remove('active');
            }
            document.getElementById('tab-' + tab).classList.add('active');
            document.getElementById('nav-' + tab).classList.add('active');
        }

        function filterArtists(q) {
            q = q.toLowerCase();
            var filtered = artists.filter(function(a) {
                return (a.name || '').toLowerCase().indexOf(q) !== -1 ||
                       (a.email || '').toLowerCase().indexOf(q) !== -1 ||
                       (a.artist_name || '').toLowerCase().indexOf(q) !== -1;
            });
            renderArtists(filtered);
        }

        function filterCurators(q) {
            q = q.toLowerCase();
            var filtered = curators.filter(function(c) {
                return (c.name || '').toLowerCase().indexOf(q) !== -1 ||
                       (c.email || '').toLowerCase().indexOf(q) !== -1;
            });
            renderCurators(filtered);
        }

        function filterCampaigns(q) {
            q = q.toLowerCase();
            var filtered = campaigns.filter(function(c) {
                return (c.artist_name || '').toLowerCase().indexOf(q) !== -1 ||
                       (c.track_title || '').toLowerCase().indexOf(q) !== -1;
            });
            renderCampaigns(filtered);
        }

        function copyEmail(email) {
            navigator.clipboard.writeText(email);
            showSuccess('Copied: ' + email);
        }

        function formatDate(d) {
            if (!d) return '-';
            return new Date(d).toLocaleDateString();
        }

        // Modal functions
        function openModal(id) {
            document.getElementById(id).classList.add('active');
        }

        function closeModal(id) {
            document.getElementById(id).classList.remove('active');
        }

        // Edit Artist
        function editArtist(id) {
            var artist = artists.find(function(a) { return a.id === id; });
            if (!artist) return;
            
            document.getElementById('edit-artist-id').value = artist.id;
            document.getElementById('edit-artist-name').value = artist.name || '';
            document.getElementById('edit-artist-artistname').value = artist.artist_name || '';
            document.getElementById('edit-artist-email').value = artist.email || '';
            document.getElementById('edit-artist-spotify').value = artist.spotify_link || '';
            document.getElementById('edit-artist-genre').value = artist.genre || '';
            document.getElementById('edit-artist-sutra').value = artist.sutra_balance || 0;
            
            openModal('editArtistModal');
        }

        function saveArtist(e) {
            e.preventDefault();
            var id = document.getElementById('edit-artist-id').value;
            var data = {
                name: document.getElementById('edit-artist-name').value,
                artist_name: document.getElementById('edit-artist-artistname').value,
                email: document.getElementById('edit-artist-email').value,
                spotify_link: document.getElementById('edit-artist-spotify').value,
                genre: document.getElementById('edit-artist-genre').value,
                sutra_balance: parseInt(document.getElementById('edit-artist-sutra').value) || 0
            };
            
            fetch(API + '/admin/artists/' + id, {
                method: 'PUT',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(data)
            })
            .then(function(res) { return res.json(); })
            .then(function(result) {
                closeModal('editArtistModal');
                showSuccess('Artist updated successfully');
                loadArtists();
            })
            .catch(function(e) {
                alert('Error updating artist: ' + e.message);
            });
        }

        // Edit Curator
        function editCurator(id) {
            var curator = curators.find(function(c) { return c.id === id; });
            if (!curator) return;
            
            document.getElementById('edit-curator-id').value = curator.id;
            document.getElementById('edit-curator-name').value = curator.name || '';
            document.getElementById('edit-curator-email').value = curator.email || '';
            document.getElementById('edit-curator-followers').value = curator.total_followers || 0;
            document.getElementById('edit-curator-status').value = curator.status || 'active';
            document.getElementById('edit-curator-spotify').value = curator.spotify_profile_url || '';
            
            openModal('editCuratorModal');
        }

        function saveCurator(e) {
            e.preventDefault();
            var id = document.getElementById('edit-curator-id').value;
            var data = {
                name: document.getElementById('edit-curator-name').value,
                email: document.getElementById('edit-curator-email').value,
                total_followers: parseInt(document.getElementById('edit-curator-followers').value) || 0,
                status: document.getElementById('edit-curator-status').value,
                spotify_profile_url: document.getElementById('edit-curator-spotify').value
            };
            
            fetch(API + '/admin/curators/' + id, {
                method: 'PUT',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(data)
            })
            .then(function(res) { return res.json(); })
            .then(function(result) {
                closeModal('editCuratorModal');
                showSuccess('Curator updated successfully');
                loadCurators();
            })
            .catch(function(e) {
                alert('Error updating curator: ' + e.message);
            });
        }

        // Export functions
        function exportArtists() {
            var csv = 'Name,Artist Name,Email,Spotify,Genre,SUTRA,Created\n';
            for (var i = 0; i < artists.length; i++) {
                var a = artists[i];
                csv += '"' + (a.name || '') + '","' + (a.artist_name || '') + '","' + (a.email || '') + '","' + (a.spotify_link || '') + '","' + (a.genre || '') + '",' + (a.sutra_balance || 0) + ',"' + (a.created_at || '') + '"\n';
            }
            downloadCSV(csv, 'artists.csv');
        }

        function exportCurators() {
            var csv = 'Name,Email,Followers,Status,Contacted,Placements\n';
            for (var i = 0; i < curators.length; i++) {
                var c = curators[i];
                csv += '"' + (c.name || '') + '","' + (c.email || '') + '",' + (c.total_followers || 0) + ',"' + (c.status || '') + '",' + (c.times_contacted || 0) + ',' + (c.placements_made || 0) + '\n';
            }
            downloadCSV(csv, 'curators.csv');
        }

        function downloadCSV(csv, filename) {
            var blob = new Blob([csv], { type: 'text/csv' });
            var url = URL.createObjectURL(blob);
            var a = document.createElement('a');
            a.href = url;
            a.download = filename;
            a.click();
        }

        // Close modals on outside click
        document.querySelectorAll('.modal').forEach(function(modal) {
            modal.addEventListener('click', function(e) {
                if (e.target === modal) {
                    modal.classList.remove('active');
                }
            });
        });
    </script>
</body>
</html>
