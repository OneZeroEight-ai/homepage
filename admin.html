<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard - OneZeroEight.ai</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        :root {
            --primary: #6366f1;
            --primary-dark: #4f46e5;
            --secondary: #10b981;
            --warning: #f59e0b;
            --danger: #ef4444;
            --dark: #1f2937;
            --darker: #111827;
            --light: #f9fafb;
            --text: #374151;
            --text-light: #6b7280;
            --border: #e5e7eb;
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--light);
            color: var(--text);
            min-height: 100vh;
        }
        .sidebar {
            position: fixed;
            left: 0;
            top: 0;
            bottom: 0;
            width: 220px;
            background: var(--darker);
            color: white;
            padding: 1.5rem 1rem;
        }
        .sidebar-logo {
            font-size: 1.2rem;
            font-weight: 700;
            color: white;
            text-decoration: none;
            display: block;
            margin-bottom: 2rem;
        }
        .sidebar-nav { list-style: none; }
        .sidebar-nav li { margin-bottom: 0.25rem; }
        .sidebar-nav a {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.75rem 1rem;
            color: rgba(255,255,255,0.7);
            text-decoration: none;
            border-radius: 8px;
            cursor: pointer;
        }
        .sidebar-nav a:hover, .sidebar-nav a.active {
            background: rgba(255,255,255,0.1);
            color: white;
        }
        .sidebar-nav a.active { background: var(--primary); }
        .sidebar-section {
            font-size: 0.7rem;
            text-transform: uppercase;
            color: rgba(255,255,255,0.4);
            margin: 1.5rem 0 0.5rem;
            padding-left: 1rem;
        }
        .main {
            margin-left: 220px;
            padding: 1.5rem;
        }
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }
        .header h1 { font-size: 1.5rem; font-weight: 700; color: var(--dark); }
        .btn {
            padding: 0.5rem 1rem;
            border-radius: 6px;
            font-weight: 600;
            font-size: 0.85rem;
            border: none;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            gap: 0.4rem;
        }
        .btn-primary { background: var(--primary); color: white; }
        .btn-primary:hover { background: var(--primary-dark); }
        .btn-secondary { background: white; color: var(--text); border: 1px solid var(--border); }
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 1rem;
            margin-bottom: 1.5rem;
        }
        .stat-card {
            background: white;
            border-radius: 10px;
            padding: 1.25rem;
            border: 1px solid var(--border);
        }
        .stat-card-title { font-size: 0.8rem; color: var(--text-light); }
        .stat-card-value { font-size: 2rem; font-weight: 700; color: var(--dark); margin-top: 0.25rem; }
        .table-card {
            background: white;
            border-radius: 10px;
            border: 1px solid var(--border);
            overflow: hidden;
        }
        .table-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem 1.25rem;
            border-bottom: 1px solid var(--border);
        }
        .table-header h2 { font-size: 1rem; font-weight: 600; color: var(--dark); }
        .search-input {
            padding: 0.5rem 0.75rem;
            border: 1px solid var(--border);
            border-radius: 6px;
            font-size: 0.85rem;
            width: 200px;
        }
        table { width: 100%; border-collapse: collapse; }
        th, td { padding: 0.75rem 1.25rem; text-align: left; border-bottom: 1px solid var(--border); }
        th { font-size: 0.75rem; font-weight: 600; color: var(--text-light); text-transform: uppercase; background: var(--light); }
        td { font-size: 0.9rem; }
        tr:hover { background: rgba(99, 102, 241, 0.02); }
        .badge {
            display: inline-block;
            padding: 0.2rem 0.6rem;
            border-radius: 50px;
            font-size: 0.75rem;
            font-weight: 500;
        }
        .badge-green { background: rgba(16, 185, 129, 0.1); color: var(--secondary); }
        .badge-blue { background: rgba(99, 102, 241, 0.1); color: var(--primary); }
        .badge-yellow { background: rgba(245, 158, 11, 0.1); color: var(--warning); }
        .badge-gray { background: rgba(107, 114, 128, 0.1); color: var(--text-light); }
        .tab-content { display: none; }
        .tab-content.active { display: block; }
        .empty-state { text-align: center; padding: 3rem; color: var(--text-light); }
        .actions a, .actions button {
            color: var(--primary);
            text-decoration: none;
            margin-right: 0.75rem;
            font-size: 0.85rem;
            background: none;
            border: none;
            cursor: pointer;
        }
        .actions a:hover, .actions button:hover { text-decoration: underline; }
        @media (max-width: 900px) {
            .sidebar { display: none; }
            .main { margin-left: 0; }
            .stats-grid { grid-template-columns: repeat(2, 1fr); }
        }
    </style>
</head>
<body>
    <aside class="sidebar">
        <a href="https://onezeroeight.ai" class="sidebar-logo">üéµ OneZeroEight</a>
        <nav>
            <ul class="sidebar-nav">
                <li><a onclick="showTab('dashboard')" class="active" id="nav-dashboard">üìä Dashboard</a></li>
                <li><a onclick="showTab('artists')" id="nav-artists">üë®‚Äçüé§ Artists</a></li>
                <li><a onclick="showTab('curators')" id="nav-curators">üë• Curators</a></li>
                <li><a onclick="showTab('campaigns')" id="nav-campaigns">üìã Campaigns</a></li>
            </ul>
            <div class="sidebar-section">Links</div>
            <ul class="sidebar-nav">
                <li><a href="https://onezeroeight.ai" target="_blank">üåê Website</a></li>
                <li><a href="https://discord.gg/4A6ExTnKnK" target="_blank">üí¨ Discord</a></li>
                <li><a href="https://polygonscan.com/token/0x0b3f81d3E1FA01e911A8B4e49048eEA0ddf2A896" target="_blank">ü™ô SUTRA</a></li>
            </ul>
        </nav>
    </aside>

    <main class="main">
        <div id="tab-dashboard" class="tab-content active">
            <div class="header">
                <h1>Dashboard</h1>
                <button class="btn btn-primary" onclick="loadAll()">üîÑ Refresh</button>
            </div>
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-card-title">Total Artists</div>
                    <div class="stat-card-value" id="stat-artists">-</div>
                </div>
                <div class="stat-card">
                    <div class="stat-card-title">Verified Curators</div>
                    <div class="stat-card-value" id="stat-curators">-</div>
                </div>
                <div class="stat-card">
                    <div class="stat-card-title">Campaigns</div>
                    <div class="stat-card-value" id="stat-campaigns">-</div>
                </div>
                <div class="stat-card">
                    <div class="stat-card-title">Placements</div>
                    <div class="stat-card-value" id="stat-placements">-</div>
                </div>
            </div>
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-card-title">Revenue</div>
                    <div class="stat-card-value" id="stat-revenue">$0</div>
                </div>
                <div class="stat-card">
                    <div class="stat-card-title">SUTRA Distributed</div>
                    <div class="stat-card-value" id="stat-sutra">0</div>
                </div>
            </div>
        </div>

        <div id="tab-artists" class="tab-content">
            <div class="header">
                <h1>Artists</h1>
                <button class="btn btn-secondary" onclick="exportArtists()">üì• Export CSV</button>
            </div>
            <div class="table-card">
                <div class="table-header">
                    <h2>All Artists</h2>
                    <input type="text" class="search-input" placeholder="Search..." oninput="filterArtists(this.value)">
                </div>
                <table>
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>Name</th>
                            <th>Artist Name</th>
                            <th>Email</th>
                            <th>Genre</th>
                            <th>SUTRA</th>
                            <th>Placements</th>
                            <th>Joined</th>
                        </tr>
                    </thead>
                    <tbody id="artists-table"></tbody>
                </table>
            </div>
        </div>

        <div id="tab-curators" class="tab-content">
            <div class="header">
                <h1>Curators</h1>
                <button class="btn btn-secondary" onclick="exportCurators()">üì• Export CSV</button>
            </div>
            <div class="table-card">
                <div class="table-header">
                    <h2>Verified Curators (<span id="curator-count">0</span>)</h2>
                    <input type="text" class="search-input" placeholder="Search..." oninput="filterCurators(this.value)">
                </div>
                <table>
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>Name</th>
                            <th>Email</th>
                            <th>Followers</th>
                            <th>Status</th>
                            <th>Contacted</th>
                            <th>Placements</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="curators-table"></tbody>
                </table>
            </div>
        </div>

        <div id="tab-campaigns" class="tab-content">
            <div class="header">
                <h1>Campaigns</h1>
            </div>
            <div class="table-card">
                <div class="table-header">
                    <h2>All Campaigns</h2>
                </div>
                <table>
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>Artist</th>
                            <th>Track</th>
                            <th>Tier</th>
                            <th>Status</th>
                            <th>Placements</th>
                            <th>Created</th>
                        </tr>
                    </thead>
                    <tbody id="campaigns-table"></tbody>
                </table>
            </div>
        </div>
    </main>

    <script>
        const API = 'https://onezeroeight-backend-production.up.railway.app/api';
        let artists = [];
        let curators = [];
        let campaigns = [];

        document.addEventListener('DOMContentLoaded', loadAll);

        async function loadAll() {
            await Promise.all([loadStats(), loadArtists(), loadCurators(), loadCampaigns()]);
        }

        async function loadStats() {
            try {
                const res = await fetch(API + '/admin/stats');
                const data = await res.json();
                document.getElementById('stat-artists').textContent = data.total_artists || 0;
                document.getElementById('stat-curators').textContent = data.total_curators || 0;
                document.getElementById('stat-campaigns').textContent = data.active_campaigns || 0;
                document.getElementById('stat-placements').textContent = data.total_placements || 0;
                document.getElementById('stat-revenue').textContent = '$' + (data.total_revenue || 0).toFixed(2);
                document.getElementById('stat-sutra').textContent = (data.sutra_distributed || 0).toFixed(0);
            } catch (e) { console.error('Stats error:', e); }
        }

        async function loadArtists() {
            try {
                const res = await fetch(API + '/admin/artists');
                const data = await res.json();
                artists = data.artists || [];
                renderArtists(artists);
            } catch (e) { console.error('Artists error:', e); }
        }

        async function loadCurators() {
            try {
                const res = await fetch(API + '/admin/curators');
                const data = await res.json();
                curators = data.curators || [];
                document.getElementById('curator-count').textContent = curators.length;
                renderCurators(curators);
            } catch (e) { console.error('Curators error:', e); }
        }

        async function loadCampaigns() {
            try {
                const res = await fetch(API + '/admin/campaigns');
                const data = await res.json();
                campaigns = data.campaigns || [];
                renderCampaigns(campaigns);
            } catch (e) { console.error('Campaigns error:', e); }
        }

        function renderArtists(list) {
            const tbody = document.getElementById('artists-table');
            if (!list.length) {
                tbody.innerHTML = '<tr><td colspan="8" class="empty-state">No artists yet</td></tr>';
                return;
            }
            tbody.innerHTML = list.map(a => '<tr>' +
                '<td>' + a.id + '</td>' +
                '<td>' + (a.name || '-') + '</td>' +
                '<td>' + (a.artist_name || '-') + '</td>' +
                '<td>' + (a.email || '-') + '</td>' +
                '<td>' + (a.genre || '-') + '</td>' +
                '<td>' + (a.sutra_balance || 0) + '</td>' +
                '<td>' + (a.total_placements || 0) + '</td>' +
                '<td>' + formatDate(a.created_at) + '</td>' +
                '</tr>').join('');
        }

        function renderCurators(list) {
            const tbody = document.getElementById('curators-table');
            if (!list.length) {
                tbody.innerHTML = '<tr><td colspan="8" class="empty-state">No curators yet</td></tr>';
                return;
            }
            tbody.innerHTML = list.map(c => '<tr>' +
                '<td>' + c.id + '</td>' +
                '<td>' + (c.name || '-') + '</td>' +
                '<td>' + (c.email || '-') + '</td>' +
                '<td>' + (c.total_followers || 0).toLocaleString() + '</td>' +
                '<td><span class="badge badge-' + (c.status === 'verified' ? 'green' : 'gray') + '">' + c.status + '</span></td>' +
                '<td>' + (c.times_contacted || 0) + '</td>' +
                '<td>' + (c.placements_made || 0) + '</td>' +
                '<td class="actions">' +
                    '<a href="' + (c.spotify_profile_url || '#') + '" target="_blank">Spotify</a>' +
                    '<button onclick="copyEmail(\'' + c.email + '\')">Copy</button>' +
                '</td>' +
                '</tr>').join('');
        }

        function renderCampaigns(list) {
            const tbody = document.getElementById('campaigns-table');
            if (!list.length) {
                tbody.innerHTML = '<tr><td colspan="7" class="empty-state">No campaigns yet</td></tr>';
                return;
            }
            tbody.innerHTML = list.map(c => '<tr>' +
                '<td>' + c.id + '</td>' +
                '<td>' + (c.artist_name || '-') + '</td>' +
                '<td>' + (c.track_title || '-') + '</td>' +
                '<td><span class="badge badge-blue">' + (c.tier || '-') + '</span></td>' +
                '<td><span class="badge badge-' + (c.status === 'completed' ? 'green' : 'yellow') + '">' + c.status + '</span></td>' +
                '<td>' + (c.placements_count || 0) + '</td>' +
                '<td>' + formatDate(c.created_at) + '</td>' +
                '</tr>').join('');
        }

        function showTab(tab) {
            document.querySelectorAll('.tab-content').forEach(function(el) { el.classList.remove('active'); });
            document.querySelectorAll('.sidebar-nav a').forEach(function(el) { el.classList.remove('active'); });
            document.getElementById('tab-' + tab).classList.add('active');
            document.getElementById('nav-' + tab).classList.add('active');
        }

        function filterArtists(q) {
            q = q.toLowerCase();
            var filtered = artists.filter(function(a) {
                return (a.name || '').toLowerCase().includes(q) ||
                       (a.email || '').toLowerCase().includes(q) ||
                       (a.artist_name || '').toLowerCase().includes(q);
            });
            renderArtists(filtered);
        }

        function filterCurators(q) {
            q = q.toLowerCase();
            var filtered = curators.filter(function(c) {
                return (c.name || '').toLowerCase().includes(q) ||
                       (c.email || '').toLowerCase().includes(q);
            });
            renderCurators(filtered);
        }

        function copyEmail(email) {
            navigator.clipboard.writeText(email);
            alert('Copied: ' + email);
        }

        function formatDate(d) {
            if (!d) return '-';
            return new Date(d).toLocaleDateString();
        }

        function exportArtists() {
            var csv = 'ID,Name,Artist Name,Email,Genre,SUTRA,Placements,Created\n';
            artists.forEach(function(a) {
                csv += [a.id, a.name, a.artist_name, a.email, a.genre, a.sutra_balance, a.total_placements, a.created_at].join(',') + '\n';
            });
            downloadCSV(csv, 'artists.csv');
        }

        function exportCurators() {
            var csv = 'ID,Name,Email,Followers,Status,Contacted,Placements\n';
            curators.forEach(function(c) {
                csv += [c.id, c.name, c.email, c.total_followers, c.status, c.times_contacted, c.placements_made].join(',') + '\n';
            });
            downloadCSV(csv, 'curators.csv');
        }

        function downloadCSV(csv, filename) {
            var blob = new Blob([csv], { type: 'text/csv' });
            var url = URL.createObjectURL(blob);
            var a = document.createElement('a');
            a.href = url;
            a.download = filename;
            a.click();
        }
    </script>
</body>
</html>
